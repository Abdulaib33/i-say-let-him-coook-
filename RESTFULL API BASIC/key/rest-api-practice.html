<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Ky.js REST API Practice</title>
</head>
<body>
  <h1>REST API with Ky.js</h1>
  <pre id="output"></pre>

  <script type="module">
    import ky from 'https://cdn.skypack.dev/ky';

    const API = 'https://jsonplaceholder.typicode.com/posts';
    const out = document.getElementById('output');

    function log(data) {
      out.textContent += JSON.stringify(data, null, 2) + '\n\n';
    }

    // Start here with one exercise at a time
    

    // Step 1 — GET all
    // const posts = await ky.get(API).json()
    // log(posts)
    // for (let i = 0; i < posts.length; i++) {
    //     log(posts[i])
    // }


    // Step 2 — GET one
    // const post = await ky.get(`${API}/1`).json()
    // log(post)                       // {
    //                                     "userId": 1,
    //                                     "id": 1,
    //                                     "title": "sunt aut facere repellat provident occaecati excepturi optio reprehenderit",
    //                                     "body": "quia et suscipit\nsuscipit recusandae consequuntur expedita et cum\nreprehenderit molestiae ut ut quas totam\nnostrum rerum est autem sunt rem eveniet architecto"
    //                                 }



    // Step 3 — POST (create)
    const newPost = await ky.post(API, {
        json: {title: 'hello', body: 'ky.js test', userId: 1}
    }).json()
    // // log(newPost)             {
    //                                 "title": "hello",
    //                                 "body": "ky.js test",
    //                                 "userId": 1,
    //                                 "id": 101
    //                             }



    // Step 4 — PUT (replace all fields)
    const updated = await ky.put(`${API}/1`, {
        json: {id: 1, title: 'Replaced', body: 'New content', userId: 1}
    }).json()
    // log(updated)                           {
    //                                             "id": 1,
    //                                             "title": "Replaced",
    //                                             "body": "New content",
    //                                             "userId": 1
    //                                         }





    // Step 5 — PATCH (update some fields)
    const patched = await ky.patch(`${API}/1`, {
        json:{title: 'Patched Title'}
    }).json()
    // log(patched)                              {
    //                                             "userId": 1,
    //                                             "id": 1,
    //                                             "title": "Patched Title",
    //                                             "body": "quia et suscipit\nsuscipit recusandae consequuntur expedita et cum\nreprehenderit molestiae ut ut quas totam\nnostrum rerum est autem sunt rem eveniet architecto"
    //                                         }




    // Step 6 — DELETE
    await ky.delete(`${API}/1`)
    // log({message: "Deleted post 1"})





// 7. Handle errors gracefully
    // Goal: If the API call fails (post doesn’t exist), your program shouldn’t crash.
    // Plan:

    //     Pick an ID you know doesn’t exist, like 9999.

    //     Wrap the ky.get() call in try...catch.

    //     If it succeeds, log the post.

    //     If it fails, log { error: "Post not found" }.

    try {

        // const post = await ky.get(API + '9999').json()
        // log(post)

    } catch {
        // log({error: 'Post not found'})
    }





    // 8. Chain requests
    //     Goal: Do one request, then use its result in the next request.
    //     Plan:

            // Make a POST request to create a new post.

            // Extract the id from the response.

            // Use that id in a GET request to fetch the same post.

            // Log both results.

    // const created = await ky.post(API, {
    //     json: {title: "New", body: "test", userId: 2}
    // }).json()
    // log(created)

    // const fetched = await ky.get(API + '/' + created.id).json()
    // log(fetched)




    // 9. Multiple GETs in parallel
    //     Goal: Fetch multiple posts at the same time instead of one by one.
    //     Plan:

    //         Create an array of IDs, e.g., [3, 4, 5].

    //         Use map() to turn them into ky.get(...).json() promises.

    //         Use Promise.all() to wait for all requests.

    //         Log all posts together.


    const ids = [3, 4, 5]
    const promises = ids.map(id => ky.get(API + '/' + id).json())
    const results = await Promise.all(promises)
    log(results)

    for ( const result of results) { 
        log({title: result.title, body: result.body})
    }



    

  </script>

  <style>
    body {
        background-color: black;
        color: wheat;
    }
  </style>
</body>
</html>
